(()=>{"use strict";class t{static get(t){return this.prop[t]}static add(t,e){this.prop.hasOwnProperty(t)||Object.defineProperty(this,t,{configurable:!0,enumerable:!0,get:()=>this.prop[t],set:e=>{this.prop[t]=e}}),this.prop[t]=e}static remove(t){return!!this.prop.hasOwnProperty(t)&&(delete this.prop[t],!0)}}t.prop={};const e=t,s=class{constructor(t,e){this.components=[],this.children=[],this.transform=t,e&&(this.renderer=e)}addComponent(t){this.components.push(t)}addChild(t){this.children.push(t)}update(){for(const t of this.components)t.update();for(const t of this.children)t.update();this.renderer.update(),this.transform.update()}render(){for(const t of this.children)t.render();this.renderer.render(this.transform.position.x,this.transform.position.y)}get getTransform(){return this.transform}get getChildren(){return this.children}getAllComponents(){return this.components}getComponent(t){return this.components.find((e=>e instanceof t))}reset(){}};class i{static init(){i.canvas=document.getElementById("gameCanvas"),i.canvas.addEventListener("mousemove",this.mouseMove)}static set position(t){i.x=t.x,i.y=t.y}static get position(){return{x:i.x,y:i.y}}}i.mouseMove=t=>{const e=i.canvas.getBoundingClientRect(),s=i.canvas.width/e.width,n=i.canvas.height/e.height,a=(t.clientX-e.left)*s,o=(t.clientY-e.top)*n;i.position={x:a,y:o}};const n=i;class a{static init(t){window.addEventListener("keydown",a.onKeyDown),window.addEventListener("keyup",a.onKeyUp),t.addEventListener("mousedown",a.onMouseDown),t.addEventListener("mouseup",a.onMouseUp),t.addEventListener("touchstart",(e=>{e.preventDefault();const s=e.touches[0];a.mouseButtons[0]=!0;const i=t.getBoundingClientRect(),o=t.width/i.width,r=t.height/i.height,h=(s.clientX-i.left)*o,d=(s.clientY-i.top)*r;n.position={x:h,y:d}})),t.addEventListener("touchmove",(e=>{e.preventDefault();const s=e.touches[0],i=t.getBoundingClientRect(),a=t.width/i.width,o=t.height/i.height,r=(s.clientX-i.left)*a,h=(s.clientY-i.top)*o;n.position={x:r,y:h}})),t.addEventListener("touchend",(t=>{t.preventDefault(),a.mouseButtons[0]=!1}))}static onKeyDown(t){a.keys[t.code]=!0}static onKeyUp(t){a.keys[t.code]=!1}static onMouseMove(t){n.mouseMove(t)}static onMouseDown(t){a.mouseButtons[t.button]=!0}static onMouseUp(t){a.mouseButtons[t.button]=!1}static isKeyDown(t){return!!a.keys[t]}static isMouseDown(t=0){return!!a.mouseButtons[t]}static reset(){a.keys={},a.mouseButtons={}}}a.keys={},a.mouseButtons={};const o=a,r=class{constructor(t=0,e=0,s=100,i=100,n=1,a=1,o=0){this.x=t,this.y=e,this.width=s,this.height=i,this.scaleX=n,this.scaleY=a,this.rotation=o}get position(){return{x:this.x,y:this.y}}get size(){return{width:this.width,height:this.height}}get scale(){return{scaleX:this.scaleX,scaleY:this.scaleY}}get rotationAngle(){return this.rotation}update(t=this.x,e=this.y,s=this.width,i=this.height,n=this.scaleX,a=this.scaleY,o=this.rotation){this.x=t,this.y=e,this.width=s,this.height=i,this.scaleX=n,this.scaleY=a,this.rotation=o}};class h{static init(){h.canvas=document.getElementById("gameCanvas"),h.ctx=h.canvas.getContext("2d")}static clear(){h.ctx.clearRect(0,0,h.canvas.width,h.canvas.height)}static setScreenSize(){const t=e.get("gameWidth"),s=e.get("gameHeight");this.canvas.width=t,this.canvas.height=s;const i=window.innerWidth,n=window.innerHeight,a=Math.min(i/t,n/s);this.canvas.style.width=t*a+"px",this.canvas.style.height=s*a+"px"}static getCanvas(){return h.canvas}static getContext(){return h.ctx}}h.drawCirle=(t,e,s,i,n,a)=>{Object.assign(h.ctx,a),h.ctx.beginPath(),h.ctx.arc(t,e,s,i,n),h.ctx.closePath(),h.ctx.fill()},h.drawRect=(t,e,s,i,n)=>{Object.assign(h.ctx,n),h.ctx.beginPath(),h.ctx.rect(t,e,s,i),h.ctx.closePath(),h.ctx.fill()},h.drawImage=(t,e,s,i,n)=>{h.ctx.drawImage(t,e,s,i,n)},h.drawAnimation=(t,e,s,i,n,a,o,r,d)=>{h.ctx.drawImage(t,e,s,i,n,a,o,r,d)},h.drawText=(t,e,s,i)=>{i.font&&(h.ctx.font=i.font),i.fillStyle&&(h.ctx.fillStyle=i.fillStyle),i.textAlign&&(h.ctx.textAlign=i.textAlign),i.textBaseline&&(h.ctx.textBaseline=i.textBaseline),h.ctx.fillText(t,e,s)};const d=h,c=class extends s{isHover(){let t=this.transform.position.x,e=this.transform.position.y,s=this.transform.size.width,i=this.transform.size.height;return n.position.x>=t&&n.position.x<=t+s&&n.position.y>=e&&n.position.y<=e+i}constructor(t,e,s,i,n,a,o="#aaa",h="#ccc"){super(new r(t,e,s,i)),this.wasDown=!1,this.text=n,this.onClick=a,this.color=o,this.hoverColor=h}update(){const t=this.isHover(),e=o.isMouseDown(0);t&&this.wasDown&&!e&&this.onClick(),this.wasDown=e}render(){let t=this.transform.position.x,e=this.transform.position.y,s=this.transform.size.width,i=this.transform.size.height;d.drawRect(t,e,s,i,{fillStyle:this.isHover()?this.hoverColor:this.color}),d.drawText(this.text,t+s/2,e+i/2,{textAlign:"center",textBaseline:"middle",fillStyle:"black",font:"20px Arial"})}};var g;class l{static loadImage(t,e){return this.image.has(t)?Promise.resolve(this.image.get(t)):new Promise(((s,i)=>{const n=new Image;n.src=e,n.onload=()=>{this.image.set(t,n),s(n)},n.onerror=()=>{i(new Error(`Failed to load image at ${e}`))}}))}static loadAudio(t,e){return this.audio.has(t)?Promise.resolve(this.audio.get(t)):new Promise(((s,i)=>{const n=new Audio(e);n.onloadeddata=()=>{this.audio.set(t,n),s(n)},n.onerror=()=>{i(new Error(`Failed to load audio at ${e}`))}}))}static getImage(t){return this.image.get(t)}static getAudio(t){return this.audio.get(t)}static clear(){this.image.clear(),this.audio.clear()}}g=l,l.init=()=>{return t=void 0,e=void 0,i=function*(){g.image=new Map,g.audio=new Map},new((s=void 0)||(s=Promise))((function(n,a){function o(t){try{h(i.next(t))}catch(t){a(t)}}function r(t){try{h(i.throw(t))}catch(t){a(t)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(o,r)}h((i=i.apply(t,e||[])).next())}));var t,e,s,i};const m=l,u=class{constructor(t){this.transform=t}checkCollision(t){return!1}update(){}get getTag(){return this.tag}},p=class{constructor(t,e,s,i){this.transform=t,this.velocity=e,this.mass=s,this.useGravity=i,this.force={x:0,y:0},this.damping=1}addForce(t){this.force.x+=t.x,this.force.y+=t.y}update(){this.useGravity&&(this.force.y+=e.get("gravity")*this.mass);const t=this.force.x/this.mass,s=this.force.y/this.mass;this.velocity.x+=t*e.get("deltaTime"),this.velocity.y+=s*e.get("deltaTime"),this.velocity.x*=Math.max(0,1-this.damping*e.get("deltaTime")),this.transform.update(this.transform.position.x+this.velocity.x*e.get("deltaTime"),Math.min(e.get("gameHeight")-224,this.transform.position.y+this.velocity.y*e.get("deltaTime"))),this.force.x=0,this.force.y=0}getVelocity(){return this.velocity}setVelocity(t){this.velocity.x=t.x,this.velocity.y=t.y}getUseGravity(){return this.useGravity}setUseGravity(t){this.useGravity=t}};class f extends u{constructor(t,e,s=-1,i=-1,n=-1,a=-1){super(t),this.offsetX=-1,this.offsetY=-1,this.width=-1,this.height=-1,-1==s?(this.xmin=t.position.x,this.ymin=t.position.y,this.xmax=t.position.x+t.size.width,this.ymax=t.position.y+t.size.height):(this.offsetX=s,this.offsetY=i,this.width=n,this.height=a,this.xmin=t.position.x+this.offsetX,this.ymin=t.position.y+this.offsetY,this.xmax=this.xmin+this.width,this.ymax=this.ymin+this.height),this.tag=e}get getMax(){return{xmax:this.xmax,ymax:this.ymax}}get getMin(){return{xmin:this.xmin,ymin:this.ymin}}checkCollision(t){return t instanceof f&&!(this.xmax<t.getMin.xmin||this.xmin>t.getMax.xmax||this.ymax<t.getMin.ymin||this.ymin>t.getMax.ymax)}update(){-1==this.offsetX?(this.xmin=this.transform.position.x,this.ymin=this.transform.position.y,this.xmax=this.transform.position.x+this.transform.size.width,this.ymax=this.transform.position.y+this.transform.size.height):(this.xmin=this.transform.position.x+this.offsetX,this.ymin=this.transform.position.y+this.offsetY,this.xmax=this.xmin+this.width,this.ymax=this.ymin+this.height),this.xmin,this.ymin,this.xmax,this.xmin,this.ymax,this.ymin}}const w=f,y=class{constructor(t){var s;this.speed=null!==(s=e.get("playerSpeed"))&&void 0!==s?s:200,this.jumped=!1,this.rb=t.getComponent(p),this.transform=t.getComponent(r),this.player=t}update(){const t=o.isKeyDown("Space"),e=o.isMouseDown(0);if((t||e)&&!this.jumped){this.jumped=!0;const{x:t,y:e}=this.player.getTransform.position;this.player.placePlatform()}t||e||(this.jumped=!1)}};var x=function(t,e,s,i){return new(s||(s=Promise))((function(n,a){function o(t){try{h(i.next(t))}catch(t){a(t)}}function r(t){try{h(i.throw(t))}catch(t){a(t)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(o,r)}h((i=i.apply(t,e||[])).next())}))};class v{static init(){return x(this,void 0,void 0,(function*(){v.playingAudios=new Map}))}static play(t,e=1){return x(this,void 0,void 0,(function*(){const s=m.getAudio(t);s.loop=!1,s.volume=e,s.currentTime=0,s.play().catch(console.error),v.playingAudios.set(t,s)}))}static stop(t){return x(this,void 0,void 0,(function*(){const e=v.playingAudios.get(t);e&&(e.pause(),e.currentTime=0)}))}static stopAll(){return x(this,void 0,void 0,(function*(){for(const t of v.playingAudios.values())t.pause(),t.currentTime=0;v.playingAudios.clear()}))}static playOnLoop(t,e=1){return x(this,void 0,void 0,(function*(){const s=m.getAudio(t);s.loop=!0,s.volume=e,s.currentTime=0,s.play().catch(console.error),v.playingAudios.set(t,s)}))}}const b=v,S=class{constructor(t){this.currentFrame=0,this.elapsed=0,this.sprite=m.getImage(t.key),this.frameWidth=t.frameWidth,this.frameHeight=t.frameHeight,this.frameCount=t.frameCount}update(){this.elapsed+=e.get("deltaTime");const t=1/e.get("FPS");this.elapsed>=t&&(this.currentFrame=(this.currentFrame+1)%this.frameCount,this.elapsed-=t)}render(t,e){const s=this.currentFrame*this.frameWidth;d.drawAnimation(this.sprite,s,0,this.frameWidth,this.frameHeight,t,e,this.frameWidth,this.frameHeight)}},T=class{constructor(t){this.animators=[],this.animators.push(new S(t))}update(){this.animators[0].update()}render(t,e){this.animators[0].render(t,e)}},A="GameOverLogo",C="https://minhduongts13.github.io/SquareAnimal/assets/images/gameOverLogo.png",O="GameOverBG",I="https://minhduongts13.github.io/SquareAnimal/assets/images/gameoverBackground.jpg",H="MenuLogo",M="https://minhduongts13.github.io/SquareAnimal/assets/images/Logo.png",q="Menu_BG",P="https://minhduongts13.github.io/SquareAnimal/assets/images/mario-background.jpg",k="Cat_Char",E="https://minhduongts13.github.io/SquareAnimal/assets/images/player.png",j="Cat_Char_Menu",_="https://minhduongts13.github.io/SquareAnimal/assets/images/characterMenu.png",B="Game_BG",G="https://minhduongts13.github.io/SquareAnimal/assets/images/ruralArea/ruralparalaxmoon.png",L="Game_BG_Cloud",Y="https://minhduongts13.github.io/SquareAnimal/assets/images/ruralArea/ruralparallaxclouds.png",D="Game_BG_Mountain",W="https://minhduongts13.github.io/SquareAnimal/assets/images/ruralArea/ruralparallaxmountain.png",K="Game_BG_MountainBack",F="https://minhduongts13.github.io/SquareAnimal/assets/images/ruralArea/ruralparallaxmountainback.png",z="Game_BG_MountainBack2",R="https://minhduongts13.github.io/SquareAnimal/assets/images/ruralArea/ruralparallaxmountainback2.png",X="Game_BG_RIVER",V="https://minhduongts13.github.io/SquareAnimal/assets/images/ruralArea/ruralparallaxriver.png",U="Game_BG_RiverFront",$="https://minhduongts13.github.io/SquareAnimal/assets/images/ruralArea/ruralparallaxriverfront.png",Q="Game_BG_RiverSkyRedlex",J="https://minhduongts13.github.io/SquareAnimal/assets/images/ruralArea/ruralparallaxriverskyredlex.png",N="Game_BG_Sky",Z="https://minhduongts13.github.io/SquareAnimal/assets/images/ruralArea/ruralparallaxsky.png",tt="Game_BG_Village",et="https://minhduongts13.github.io/SquareAnimal/assets/images/ruralArea/ruralparallaxvillage.png",st="Game_Ground",it="https://minhduongts13.github.io/SquareAnimal/assets/images/ruralArea/ground.png",nt="Obstacle_1",at="https://minhduongts13.github.io/SquareAnimal/assets/images/obstacle/ob1.png",ot=96,rt=448,ht="Obstacle_2",dt="https://minhduongts13.github.io/SquareAnimal/assets/images/obstacle/ob2.png",ct=96,gt=288,lt="Obstacle_3",mt="https://minhduongts13.github.io/SquareAnimal/assets/images/obstacle/ob3.png",ut=96,pt=448,ft="Obstacle_4",wt="https://minhduongts13.github.io/SquareAnimal/assets/images/obstacle/ob4.png",yt=32,xt=448,vt="Obstacle_5",bt="https://minhduongts13.github.io/SquareAnimal/assets/images/obstacle/ob5.png",St=448,Tt=448,At="Obstacle_6",Ct="https://minhduongts13.github.io/SquareAnimal/assets/images/obstacle/ob6.png",Ot=448,It=448,Ht="Obstacle_7",Mt="https://minhduongts13.github.io/SquareAnimal/assets/images/obstacle/ob7.png",qt=448,Pt=448,kt="Obstacle_8",Et="https://minhduongts13.github.io/SquareAnimal/assets/images/obstacle/ob8.png",jt=448,_t=448,Bt="SQUARE",Gt="https://minhduongts13.github.io/SquareAnimal/assets/images/square.png",Lt="Loading_BG",Yt="https://minhduongts13.github.io/SquareAnimal/assets/images/loading-background.jpg",Dt="Loading_Icon",Wt="https://minhduongts13.github.io/SquareAnimal/assets/images/loading.png",Kt="Loading_Text",Ft="https://minhduongts13.github.io/SquareAnimal/assets/images/loading-text.png",zt={x:0,y:700},Rt="OBSTACLE",Xt="SPIKE",Vt="HEAD",Ut="PLAYER",$t={x:32,y:100},Qt="HEAD",Jt="BOX",Nt={x:0,y:800},Zt="highscore",te={KEY:"Menu_Music",PATH:"https://minhduongts13.github.io/SquareAnimal/assets/sounds/menu_music.mp3"},ee={KEY:"GamePlay_Music",PATH:"https://minhduongts13.github.io/SquareAnimal/assets/sounds/gameplay_music.mp3"},se={KEY:"GamePlay_Box",PATH:"https://minhduongts13.github.io/SquareAnimal/assets/sounds/square.mp3"},ie={KEY:"GameOver_Sound",PATH:"https://minhduongts13.github.io/SquareAnimal/assets/sounds/game-over-sound.mp3"},ne=class{constructor(t){this.image=m.getImage(t.key),this.width=t.width,this.height=t.height}update(){}render(t,e){d.drawImage(this.image,t,e,this.width,this.height)}},ae=class extends s{constructor(t){super(new r(Nt.x,Nt.y,32,32)),this.renderer=new ne({key:Bt,width:32,height:32});let e=new p(this.transform,{x:0,y:0},100,!0);this.addComponent(e),this.addComponent(new w(this.transform,Jt));let s=new w(this.transform,Qt,32,2,1,28);this.addComponent(s),this.active=!1,this.id=t}reset(){this.transform.update(Nt.x,Nt.y),this.active=!1}work(t,e){this.transform.update(t,e),this.active=!0}getId(){return this.id}};class oe{static create(){this.pool=[];for(let t=0;t<18;t++)this.pool.push(new ae(t))}static get(){return this.pool.pop()}static getAll(){return this.pool}static release(t){t.reset(),this.pool.push(t)}}oe.pool=[];const re=oe,he=class extends s{constructor(){super(new r($t.x,$t.y,32,32)),this.renderer=new T({key:k,frameWidth:32,frameHeight:32,frameCount:6});let t=new y(this),e=new w(this.transform,Ut),s=new w(this.transform,Vt,32,4,1,24),i=new p(this.transform,{x:0,y:0},100,!0);this.addComponent(e),this.addComponent(s),this.addComponent(i),this.addComponent(t)}placePlatform(){if(this.transform.position.y<32)return;b.play(se.KEY,.5);const t=this.transform.position.x,e=this.transform.position.y+this.transform.size.height;let s=re.get();s.work(t,e),this.children.push(s)}releaseSquare(t){for(let e=0;e<this.children.length;e++)this.children[e].getId()==t&&(re.release(this.children[e]),this.children.splice(e,1))}reset(){this.transform.update($t.x,$t.y);for(let t of this.children)re.release(t);this.children=[]}};class de{static create(){this.pool=[];let t=new ge(nt,ot,rt);t.addComponent(new w(t.getTransform,Rt,0,0,96,192)),t.addComponent(new w(t.getTransform,Rt,0,288,96,160));let e=new ge(ht,ct,gt);e.addComponent(new w(e.getTransform,Rt));let s=new ge(lt,ut,pt);s.addComponent(new w(s.getTransform,Rt,0,192,96,256));let i=new ge(ft,yt,xt);i.addComponent(new w(i.getTransform,Rt,0,0,32,64)),i.addComponent(new w(i.getTransform,Rt,0,128,32,64)),i.addComponent(new w(i.getTransform,Rt,0,256,32,64)),i.addComponent(new w(i.getTransform,Rt,0,384,32,64));let n=new ge(vt,St,Tt);n.addComponent(new w(n.getTransform,Rt,0,416,32,32)),n.addComponent(new w(n.getTransform,Rt,32,384,32,64)),n.addComponent(new w(n.getTransform,Rt,64,352,32,96)),n.addComponent(new w(n.getTransform,Rt,96,320,32,128)),n.addComponent(new w(n.getTransform,Rt,128,288,96,160)),n.addComponent(new w(n.getTransform,Rt,224,320,32,96)),n.addComponent(new w(n.getTransform,Rt,256,416,96,32)),n.addComponent(new w(n.getTransform,Rt,352,384,32,64)),n.addComponent(new w(n.getTransform,Rt,384,352,64,96));let a=new ge(At,Ot,It);a.addComponent(new w(a.getTransform,Rt,0,320,32,128)),a.addComponent(new w(a.getTransform,Rt,96,320,32,128)),a.addComponent(new w(a.getTransform,Rt,192,320,32,128)),a.addComponent(new w(a.getTransform,Rt,288,320,32,128)),a.addComponent(new w(a.getTransform,Rt,384,320,32,128));let o=new ge(Ht,qt,Pt);o.addComponent(new w(o.getTransform,Xt,0,384,64,64)),o.addComponent(new w(o.getTransform,Rt,64,384,64,64)),o.addComponent(new w(o.getTransform,Xt,128,384,64,64)),o.addComponent(new w(o.getTransform,Rt,192,384,64,64)),o.addComponent(new w(o.getTransform,Xt,256,384,64,64)),o.addComponent(new w(o.getTransform,Rt,320,384,64,64)),o.addComponent(new w(o.getTransform,Xt,384,384,64,64));let r=new ge(kt,jt,_t);if(r.addComponent(new w(r.getTransform,Xt,0,320,32,64)),r.addComponent(new w(r.getTransform,Rt,0,384,32,64)),r.addComponent(new w(r.getTransform,Xt,96,288,32,64)),r.addComponent(new w(r.getTransform,Rt,96,352,32,96)),r.addComponent(new w(r.getTransform,Xt,192,224,32,64)),r.addComponent(new w(r.getTransform,Rt,192,288,32,96)),r.addComponent(new w(r.getTransform,Xt,288,288,32,64)),r.addComponent(new w(r.getTransform,Rt,288,352,32,96)),r.addComponent(new w(r.getTransform,Xt,384,192,32,64)),r.addComponent(new w(r.getTransform,Rt,384,256,32,96)),0==de.pool.length)this.pool.push(t,e,s,i,n,a,o,r);else for(let t of de.pool)t.reset()}static get(t){return this.pool[t].active=!0,this.pool[t]}static getAll(){return this.pool}static release(t){t.active=!1,console.log(1),t.reset()}}de.pool=[];const ce=de,ge=class extends s{constructor(t,e,s){super(new r(zt.x,zt.y,e,s)),this.active=!1,this.renderer=new ne({key:t,width:e,height:s})}reset(){this.transform.update(zt.x,zt.y),this.active=!1}update(){this.active&&(super.update(),this.transform.update(this.transform.position.x-e.get("gameSpeed")*e.get("deltaTime")),this.transform.position.x<-this.transform.size.width&&ce.release(this))}},le=class{init(){this.gameObjects=[]}collectCollider(t){let e=[];for(const s of t){if(!(s instanceof ge)||s.active)for(let t of s.getAllComponents())t instanceof u&&e.push({go:s,col:t});const t=s.getChildren;t.length>0&&e.push(...this.collectCollider(t))}return e}update(t){this.gameObjects=t;for(const t of this.gameObjects){let e=t.getComponent(p);e&&e.update(),t.getChildren.forEach((t=>{e=t.getComponent(p),e&&e.update()}))}let e=this.collectCollider(this.gameObjects);console.log(e);for(let t=0;t<e.length;t++)for(let s=t+1;s<e.length;s++){const i=e[t],n=e[s];if(i.col.checkCollision(n.col))if(i.go instanceof he&&n.go instanceof ae)this.landOnPlatform(i.go,n.go);else if(n.go instanceof he&&i.go instanceof ae)this.landOnPlatform(n.go,i.go);else if(i.go instanceof ae&&n.go instanceof ae){if(i.col.getTag==Qt||n.col.getTag==Qt)continue;i.col.transform.position.x>-10&&this.landOnPlatform(n.go,i.go)}else i.go instanceof he&&n.go instanceof ge?n.col.getTag==Xt||i.col.getTag==Vt?Ee.switchScene("gameover"):this.landOnObstacle(i.go,n.go):i.go instanceof ge&&n.go instanceof he?i.col.getTag==Xt||i.col.getTag==Vt?Ee.switchScene("gameover"):this.landOnObstacle(n.go,i.go):i.go instanceof ae&&n.go instanceof ge?i.col.getTag==Qt?this.stopSquareObstacle(i.go,n.go):n.col.getTag==Xt?this.destroySquareObstacle(i.go,n.go):this.goSquareObstacle(i.go,n.go):i.go instanceof ge&&n.go instanceof ae&&(n.col.getTag==Qt?this.stopSquareObstacle(n.go,i.go):i.col.getTag==Xt?this.destroySquareObstacle(n.go,i.go):this.goSquareObstacle(n.go,i.go))}}landOnObstacle(t,e){const s=t.getComponent(p);s.setVelocity({x:s.getVelocity().x,y:0})}landOnPlatform(t,e){const s=t.getTransform,i=e.getTransform.position.y-s.size.height;s.update(s.position.x,i);const n=t.getComponent(p);n.setVelocity({x:n.getVelocity().x,y:0})}stopSquareObstacle(t,s){let i;t.getTransform.update(t.getTransform.position.x-e.get("gameSpeed")*e.get("deltaTime"));for(let t of this.gameObjects)if(t instanceof he){i=t;break}t.getTransform.position.x<-50&&(null==i||i.releaseSquare(t.getId()),e.add("score",e.get("score")+1))}destroySquareObstacle(t,s){let i;for(let t of this.gameObjects)if(t instanceof he){i=t;break}null==i||i.releaseSquare(t.getId()),e.add("score",e.get("score")+1)}goSquareObstacle(t,e){const s=t.getComponent(p);s.setVelocity({x:s.getVelocity().x,y:0})}};var me=function(t,e,s,i){return new(s||(s=Promise))((function(n,a){function o(t){try{h(i.next(t))}catch(t){a(t)}}function r(t){try{h(i.throw(t))}catch(t){a(t)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(o,r)}h((i=i.apply(t,e||[])).next())}))};const ue=class{constructor(){this.setup=()=>me(this,void 0,void 0,(function*(){this.physicsHandler.init(),d.setScreenSize()})),this.gameObjects=[],this.physicsHandler=new le,this.physicsHandler.init(),this.loaded=!1,this.setup(),window.addEventListener("resize",(()=>{d.setScreenSize()}))}run(){d.drawRect(0,0,window.innerWidth,window.innerHeight,{fillStyle:"white"});for(let t of this.gameObjects)t.update(),t.render();this.physicsHandler.update(this.gameObjects)}end(){}reset(){for(let t of this.gameObjects)t.reset();this.physicsHandler.init(),b.stopAll()}preload(){return me(this,void 0,void 0,(function*(){}))}create(){}addObject(t){this.gameObjects.push(t)}addObjects(t){for(let e of t)this.addObject(e)}},pe=class extends s{constructor(){super(new r(10,485,64,64)),this.renderer=new T({key:j,frameWidth:64,frameHeight:64,frameCount:10})}},fe=class extends s{constructor(){super(new r(0,0)),this.transform=new r(0,0),this.renderer=new ne({key:q,width:e.get("gameWidth"),height:e.get("gameHeight")})}},we=class extends s{constructor(){super(new r(0,80)),this.renderer=new ne({key:H,width:460,height:88})}};const ye=class extends ue{constructor(){super()}create(){this.gameObjects.push(new fe),this.gameObjects.push(new c(150,200,150,50,"Play",(()=>{Ee.switchScene("gameplay")}),"yellow","#FFFA8D")),this.gameObjects.push(new we),this.gameObjects.push(new pe);const t=()=>{b.play(te.KEY,.5),window.removeEventListener("click",t),window.removeEventListener("touchstart",t)};window.addEventListener("click",t,{once:!0}),window.addEventListener("touchstart",t,{once:!0})}preload(){return t=this,e=void 0,i=function*(){this.loaded||(yield m.loadImage(j,_),yield m.loadImage(q,P),yield m.loadImage(H,M),yield m.loadAudio(te.KEY,te.PATH)),this.loaded=!0,this.create()},new((s=void 0)||(s=Promise))((function(n,a){function o(t){try{h(i.next(t))}catch(t){a(t)}}function r(t){try{h(i.throw(t))}catch(t){a(t)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(o,r)}h((i=i.apply(t,e||[])).next())}));var t,e,s,i}wait(t){return new Promise((e=>setTimeout(e,t)))}reset(){b.playOnLoop(te.KEY,.5)}},xe=class extends s{constructor(){super(new r(0,0)),this.transform=new r(0,0),this.renderer=new ne({key:O,width:e.get("gameWidth"),height:e.get("gameHeight")})}},ve=class extends s{constructor(){super(new r(0,0)),this.transform=new r(0,80),this.renderer=new ne({key:A,width:460,height:118})}};var be=function(t,e,s,i){return new(s||(s=Promise))((function(n,a){function o(t){try{h(i.next(t))}catch(t){a(t)}}function r(t){try{h(i.throw(t))}catch(t){a(t)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(o,r)}h((i=i.apply(t,e||[])).next())}))};const Se=class extends ue{constructor(){super()}create(){this.gameObjects.push(new xe),this.gameObjects.push(new ve),this.gameObjects.push(new c(150,250,150,50,"Restart",(()=>be(this,void 0,void 0,(function*(){Ee.switchScene("gameplay")}))),"#A4DD00","#B6F500")),this.gameObjects.push(new c(150,320,150,50,"Back to Menu",(()=>be(this,void 0,void 0,(function*(){yield Ee.switchScene("menu")}))),"yellow","#FFFA8D"))}preload(){return be(this,void 0,void 0,(function*(){this.loaded||(yield m.loadImage(O,I),yield m.loadImage(A,C),yield m.loadAudio(ie.KEY,ie.PATH),this.create(),this.loaded=!0)}))}run(){super.run(),d.drawText(`High Score: ${this.getHighScore()}`,220,200,{fillStyle:"rgb(141, 108, 0)"}),d.drawText(`Your Score: ${e.get("score")}`,220,230,{fillStyle:"rgb(141, 108, 0)"})}reset(){super.reset(),b.play(ie.KEY,.5),this.setHighScoreIfHigher(e.get("score"))}getHighScore(){const t=localStorage.getItem(Zt);return t?parseInt(t,10):0}setHighScoreIfHigher(t){return t>this.getHighScore()&&(localStorage.setItem(Zt,t.toString()),!0)}clear(){localStorage.removeItem(Zt)}},Te=class{constructor(t,e,s,i){this.x1=0,this.img=m.getImage(t),this.x2=this.img.width,this.speed=s,this.height=i}update(){this.x1-=this.speed*e.get("deltaTime"),this.x2-=this.speed*e.get("deltaTime");const t=this.img.width;this.x1+t<=0&&(this.x1=this.x2+t),this.x2+t<=0&&(this.x2=this.x1+t)}render(){d.drawImage(this.img,this.x1,0,this.img.width,this.height),d.drawImage(this.img,this.x2,0,this.img.width,this.height)}},Ae=class extends s{constructor(){super(new r(0,0)),this.layers=[new Te(N,Z,Math.floor(0*e.get("gameSpeed")),e.get("gameHeight")),new Te(B,G,Math.floor(1/9*e.get("gameSpeed")),e.get("gameHeight")),new Te(L,Y,Math.floor(30/180*e.get("gameSpeed")),e.get("gameHeight")),new Te(K,F,Math.floor(40/180*e.get("gameSpeed")),e.get("gameHeight")),new Te(z,R,Math.floor(60/180*e.get("gameSpeed")),e.get("gameHeight")),new Te(D,W,Math.floor(80/180*e.get("gameSpeed")),e.get("gameHeight")),new Te(X,V,Math.floor(100/180*e.get("gameSpeed")),e.get("gameHeight")),new Te(U,$,Math.floor(120/180*e.get("gameSpeed")),e.get("gameHeight")),new Te(Q,J,Math.floor(30/180*e.get("gameSpeed")),e.get("gameHeight")),new Te(tt,et,Math.floor(140/180*e.get("gameSpeed")),e.get("gameHeight"))]}update(){this.layers.forEach(((t,e)=>t.update()))}render(){d.clear(),this.layers.forEach(((t,e)=>t.render()))}},Ce=class extends s{constructor(){super(new r(0,e.get("gameHeight")-192,e.get("gameWidth"),192)),this.img=m.getImage(st),this.x1=0,this.x2=e.get("gameWidth"),this.tag="ground"}update(){this.x1-=e.get("gameSpeed")*e.get("deltaTime"),this.x2-=e.get("gameSpeed")*e.get("deltaTime");const t=e.get("gameWidth");this.x1+t<=0&&(this.x1=this.x2+t),this.x2+t<=0&&(this.x2=this.x1+t);for(const t of this.components)t.update()}render(){d.drawImage(this.img,this.x1,e.get("gameHeight")-192,e.get("gameWidth"),192),d.drawImage(this.img,this.x2,e.get("gameHeight")-192,e.get("gameWidth"),192)}};const Oe=class extends ue{constructor(){super(),this.timer=0,this.speedtimer=0,this.prevOb=-1,this.spawnInterval=5,this.spawnPoint={x:e.get("gameWidth")+300,y:0},e.add("gameSpeed",180)}preload(){return t=this,e=void 0,i=function*(){this.loaded||(yield m.loadImage(k,E),yield m.loadImage(q,P),yield m.loadImage(H,M),yield m.loadImage(B,G),yield m.loadImage(L,Y),yield m.loadImage(D,W),yield m.loadImage(K,F),yield m.loadImage(z,R),yield m.loadImage(X,V),yield m.loadImage(U,$),yield m.loadImage(N,Z),yield m.loadImage(Q,J),yield m.loadImage(tt,et),yield m.loadImage(st,it),yield m.loadImage(nt,at),yield m.loadImage(ht,dt),yield m.loadImage(lt,mt),yield m.loadImage(ft,wt),yield m.loadImage(vt,bt),yield m.loadImage(At,Ct),yield m.loadImage(Ht,Mt),yield m.loadImage(kt,Et),yield m.loadImage(Bt,Gt),yield m.loadAudio(ee.KEY,ee.PATH),yield m.loadAudio(se.KEY,se.PATH),this.loaded=!0,this.create())},new((s=void 0)||(s=Promise))((function(n,a){function o(t){try{h(i.next(t))}catch(t){a(t)}}function r(t){try{h(i.throw(t))}catch(t){a(t)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(o,r)}h((i=i.apply(t,e||[])).next())}));var t,e,s,i}create(){this.timer=0,this.gameObjects.push(new Ae),this.gameObjects.push(new Ce),this.gameObjects.push(new he),re.create(),ce.create(),ce.getAll().forEach((t=>{this.gameObjects.push(t)}))}run(){if(this.timer+=e.get("deltaTime"),this.speedtimer+=e.get("deltaTime"),this.timer>=this.spawnInterval){this.timer=0;let t=Math.floor(8*Math.random());this.prevOb==t&&(t=(t+1)%8),this.prevOb=t,ce.get(t).getTransform.update(this.spawnPoint.x,this.spawnPoint.y)}this.speedtimer>=14&&(e.add("gameSpeed",e.get("gameSpeed")+40),this.spawnInterval=Math.max(1,this.spawnInterval-.5),this.speedtimer=0);for(let t of this.gameObjects)t.update(),t.render();this.physicsHandler.update(this.gameObjects),d.drawText(`Score: ${e.get("score")}`,60,25,{fillStyle:"rgb(117, 80, 0)",font:"25px Arial"})}reset(){super.reset(),this.timer=0,this.spawnInterval=5,e.add("gameSpeed",180),e.add("score",0),this.prevOb=-1,b.playOnLoop(ee.KEY)}},Ie=class extends s{constructor(){super(new r(0,0)),this.renderer=new ne({key:Lt,width:e.get("gameWidth"),height:e.get("gameHeight")})}},He=class extends s{constructor(){super(new r(e.get("gameWidth")/2-30,e.get("gameHeight")/2-100)),this.renderer=new T({key:Dt,frameWidth:64,frameHeight:64,frameCount:12})}},Me=class extends s{constructor(){super(new r(20,100)),this.renderer=new ne({key:Kt,width:429,height:120})}};const qe=class extends ue{constructor(){super()}create(){this.gameObjects=[],this.gameObjects.push(new Ie),this.gameObjects.push(new He),this.gameObjects.push(new Me)}preload(){return t=this,e=void 0,i=function*(){yield m.loadImage(Lt,Yt),yield m.loadImage(Dt,Wt),yield m.loadImage(Kt,Ft),this.create()},new((s=void 0)||(s=Promise))((function(n,a){function o(t){try{h(i.next(t))}catch(t){a(t)}}function r(t){try{h(i.throw(t))}catch(t){a(t)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(o,r)}h((i=i.apply(t,e||[])).next())}));var t,e,s,i}};var Pe;class ke{static init(){return t=this,e=void 0,i=function*(){ke.scenes=new Map,ke.scenes.set("loading",new qe),ke.scenes.set("menu",new ye),ke.scenes.set("gameplay",new Oe),ke.scenes.set("gameover",new Se),ke.currentScene="loading",yield ke.scenes.get("loading").preload()},new((s=void 0)||(s=Promise))((function(n,a){function o(t){try{h(i.next(t))}catch(t){a(t)}}function r(t){try{h(i.throw(t))}catch(t){a(t)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(o,r)}h((i=i.apply(t,e||[])).next())}));var t,e,s,i}}Pe=ke,ke.switchScene=t=>{ke.scenes.get(ke.currentScene).end(),ke.currentScene="loading";const e=ke.scenes.get(t);e.preload().then((()=>{e.reset(),ke.currentScene=t}))},ke.update=()=>{ke.scenes.get(Pe.currentScene).run()};const Ee=ke;new class{constructor(){this.paused=!1,this.setup=()=>{return t=this,s=void 0,a=function*(){e.add("imgsrc","../../assets/images/"),e.add("score",0),e.add("soundsrc","../../assets/sounds/"),e.add("FPS",8),e.add("gravity",98),e.add("gameWidth",448),e.add("gameHeight",640),yield m.init(),d.init(),n.init(),o.init(d.getCanvas()),yield Ee.init(),this.lastTime=Date.now(),yield b.init(),Ee.switchScene("menu")},new((i=void 0)||(i=Promise))((function(e,n){function o(t){try{h(a.next(t))}catch(t){n(t)}}function r(t){try{h(a.throw(t))}catch(t){n(t)}}function h(t){var s;t.done?e(t.value):(s=t.value,s instanceof i?s:new i((function(t){t(s)}))).then(o,r)}h((a=a.apply(t,s||[])).next())}));var t,s,i,a},this.run=()=>{if(this.paused){const t=d.getCanvas();d.drawRect(0,0,t.width,t.height,{fillStyle:"rgba(0, 0, 0, 0.1)"}),d.drawText("Paused",t.width/2,t.height/2,{textAlign:"center",textBaseline:"middle",font:"48px Arial",fillStyle:"white"})}else{let t=Date.now();e.add("deltaTime",(t-this.lastTime)/1e3),this.lastTime=t,Ee.update()}requestAnimationFrame(this.run)},this.setup().then((()=>{this.run()})),window.addEventListener("blur",(()=>{this.paused=!0})),window.addEventListener("focus",(()=>{this.paused=!1,this.lastTime=Date.now()}))}}})();